<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <title>fetching v0.1</title>
    <script type = "text/javascript" src = "http://ajax.googleapis.com/ajax/libs/jquery/2.1.3/jquery.min.js"></script>
  </head>
  <body>
    <script>
    'use strict';
    let NOT_FOUND = "not found";

    //----------------------------------------------------------------
    var transitionTable = [
	["a","A"],
	["i","I"],
	["u","U"],
	["r","R","RR"],
	["l","lR","lRR"],
	["h","H"],
	["M","n","N","J","G"],
	["z","S","s"],
	["b","v"],
	["k","kh"],
	["g","gh"],
	["c","ch"],
	["j","jh"],
	["T","Th","t","th"],
	["D","Dh","d","dh"],
	["p","ph"],
	["b","bh"],
	["sh","z"]
]

var searchList;

function doVariant(pref, word) {

	if (pref.length == 0) {
		searchList.push(word);
	}

	if (word.length==0) {
		return;
	 }

	var varChar = getChar(word);

	if (word.length > 1) {
		doVariant(pref + word[0], word.substring(1));
	}

	transitionTable.forEach(function(variants) {
    	var cases = [];
    	var isExist = false;

    	variants.forEach(function(variant) {
    		if (variant == varChar) {
    			isExist = true;
    		} else {
    			cases.push(variant);
    		}
		});

    	if (isExist == true) {
    		cases.forEach(function(newChar) {
    			var subWord = word.substring(varChar.length);
    			searchList.push(pref + newChar + subWord);
    			if (word.length > 1) {
    				doVariant(pref + newChar, subWord);
    			}
			});
    	}
	});
}

function getChar(word) {

	var newChar = "";

	transitionTable.forEach(function(variants) {
		variants.forEach(function(variant) {
			var ln = variant.length;
			if (word.substring(0,ln) == variant) {
				if ( ln > newChar.length) {
					newChar = variant;
				}
			}
		});
	});

	return newChar;
}

function getVariants(word){
	searchList = [];
	//console.log(word);

	doVariant("",word);

	console.log(searchList.toString());

  return searchList;
}


    </script>

    <script>
    var llist = [];
    var errlist = [];
    var handleCount = 0;
    var repeatCnt = 0;
    llist.sort(function(a,b){
      var res;
      if (a.frequency >= 0){
          res = a.frequency - b.frequency;
      } else {
        if (b.frequency < 0) {
          res = 0-res;
        } else {
          res = -1;
        }
      }

      return res;
    });

    function test(find_word) {
      llist = [];
      errlist = [];
      handleCount = 0;
      repeatCnt = 0;
      find_word = find_word.trim();
      //document.body.innerHTML = 'Loading...';
       $('#outputdiv').html("<p>Loading...</p>");
    var res = getVariants(find_word, llist);
    var test ={};
    test.key = res.join(',');
    test.nkey = res.length;
    //test.url = "http://www.sanskrit-lexicon.uni-koeln.de/scans/WILScan/2014/web/webtc/getword_phreebie.php";
    test.url = "http://www.sanskrit-lexicon.uni-koeln.de/scans/awork/apidev/simple-search/v0.1/getword_xml_v1.php";
    //test.url = "http://www.sanskrit-lexicon.uni-koeln.de/scans/awork/apidev/getword_xml_v1.php";
    //test.transLit = 'hk';
    //test.filter = 'deva';
    test.input = 'hk';
    test.output = 'deva';
    test.dict = 'mw'; //'wil';
    //var dataurl = test.url + "?key="+test.key+"&filter="+test.filter+"&noLit="+test.noLit+"&transLit=" + test.transLit;
    //var dataurl = test.url + "?key="+test.key+"&input="+test.input+"&output=" + test.output;
    // temporary debug
    //test.key = res[0];
    var dataurl = test.url+"?input="+test.input+"&output=" + test.output +
         "&dict="+test.dict +
         "&key="+test.key;
        //console.log('ejf. dataurl=',dataurl);
         /*
          $.ajax({
            url: dataurl,
            cache: false,
            method: "GET",
          })
         */
	 $('#outputdiv').html("<p>Accessing server with " + test.nkey +
             " alternates ...</p>");
          $.ajax({
            url: test.url,
            cache: false,
            method: "POST",
	    data: {
             input:test.input,
	     output:test.output,
	     dict:test.dict,
	     key:test.key
            }
          })

            .done(function( json ) {
                console.log('json = ',json);
                var results = json['result'];
                var html = '';
                var html = "<p>Server checked " + test.nkey +
             " alternates. <br/> 200 code means found in " + test.dict +
             ". <br/> 3rd field is word frequencey score (or -1 or -9)</p>";
                results.forEach(function(result) {
	         var keyin = result.keyin;
                 var keyslp = result.key;
	         var status = result.status;
	         var wf = result.wf;
	         html = html + keyin + ' (' + keyslp + ') '+ status + ' ' + wf +'<br/>';
                });
                
                $('#outputdiv').html(html);
            })
            .fail(function( jqXHR, textStatus, errorThrown){
              errlist.push(dataurl + " " +textStatus.toString()+" "+errorThrown.toString()+"<br>");
            });
  } // test function
    
    </script>

    <script type="text/javascript">
    function openInNewTab(url) {
      var win = window.open(url, '_blank');
      win.focus();
    }
    </script>
	   <input type="text" size="40" onchange="test(this.value)">
    <!--
     <a href="#" onclick="openInNewTab('settings.html');">Settings>></a>
    -->
   <div id="outputdiv"></div>
  </body>
</html>
