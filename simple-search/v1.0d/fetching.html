<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <title>fetching v0.3b</title>
    <script type = "text/javascript" src = "//ajax.googleapis.com/ajax/libs/jquery/2.1.3/jquery.min.js"></script>
  </head>
  <body>

 <script>
 function test(find_word) {
  find_word = find_word.trim();
  var test ={}; // Javascript object to pass as parameters
  //console.log('test: find_word=',find_word);
  test.key = find_word;
  test.url = "//www.sanskrit-lexicon.uni-koeln.de/scans/awork/apidev/simple-search/v0.3b/getword_xml_v3.php";
  test.input = 'hk';
  test.output = 'deva';
  test.dict = 'mw'; //'wil';
  $('#outputdiv').html("<p>Accessing server for alternates of " + test.key +
  "  ...</p>");
  $.ajax({
   url: test.url,
   cache: false,
   method: "POST",
   data: {
    input:test.input, // not currently used
    output:test.output, // not currently used
    dict:test.dict, // not currently used
    key:test.key
   }
  }) // end of $.ajax
  .done(function( json ) {
   //console.log('json = ',json);
   var results = json['result'];
   var htmlarr = [];
   htmlarr.push("<p>");
   htmlarr.push("Server returns " + results.length + " alternates. <br/> ");
   htmlarr.push("200 code means found in " + test.dict +". <br/> ");
   htmlarr.push("3rd field is word frequency score (or -1 or -9)<br/> ");
   htmlarr.push("last field is hwnorm1c data");
   htmlarr.push("</p>");
   var iresult = 0;
   var nfound = 0; 
   results.forEach(function(result) {
    iresult = iresult + 1;
    var keyin = result.keyin;
    var keyslp = result.key;
    var status = result.status;
    var wf = result.wf;
    var data = result.xml;
    if (status == 200) {
     nfound = nfound + 1;
     /*
     htmlarr.push(iresult + ': ' + keyin + ' (' + keyslp + ') '+ status  
               + ' ' +  wf +' ' + data +'<br/>');
     */
     htmlarr.push(iresult + ': ' + keyin + ' (' + keyslp + ') '+ status  
               + ' ' +  wf + '<br/>');
     /* data  is like  1: kavi (kavi) 200 44 
       kavi:ACC,AP,AP90,BEN,BOP,BUR,CAE,CCS,GRA,INM,MD,MW,MW72,PE,PUI,PW,PWG,SCH,SHS,STC,VCP,WIL,YAT;kaviH:SKD
       two levels: split at semicolon result is KEY:D1,D2,...
     */
     //var thetype = typeof data;
     var datastr = '' + data;
     console.log('type of data = ',typeof data);
     var parts = datastr.split(';');
     parts.forEach(function(item,index) {
      htmlarr.push("&nbsp;&nbsp;&nbsp;&nbsp;" + item + "<br/>");
     });
    }
   }); // results.foreach
   if (nfound == 0) {
    htmlarr.push("WORD NOT FOUND");
   }
   var html = htmlarr.join("\n");
   $('#outputdiv').html(html);
  }) // end of .done function
  .fail(function( jqXHR, textStatus, errorThrown){
    $('#outputdiv').html = 
     textStatus.toString()+" "+errorThrown.toString()+"<br>";
 }); // end of $.ajax 
 } // test function
 
 </script>

 <input type="text" size="40" onchange="test(this.value)">
 <div id="outputdiv"></div>
 </body>
</html>
