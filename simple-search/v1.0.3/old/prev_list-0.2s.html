<!DOCTYPE html> <!-- html5 -->
<html>
<head>
<META charset="UTF-8">
<title>list-0.2s Cologne</title>
<link rel="stylesheet" type="text/css" href="https://cdnjs.cloudflare.com/ajax/libs/jqueryui/1.11.4/jquery-ui.min.css">
<!-- links to jquery, using CDNs -->
<script type="text/javascript" src="//code.jquery.com/jquery-2.1.4.min.js"></script>

<script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/jquery-cookie/1.4.1/jquery.cookie.min.js"></script>
<!-- jquery-ui is used -->
<script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/jqueryui/1.11.4/jquery-ui.min.js"></script>
<script type="text/javascript" src="//www.sanskrit-lexicon.uni-koeln.de/scans/awork/apidev/sample/dictnames.js"></script>
<script type="text/javascript" src="//www.sanskrit-lexicon.uni-koeln.de/scans/awork/apidev/sample/cookieUpdate.js"></script>

<style>
body {
 color: black; background-color:#DBE4ED;
 /*font-size: 14pt; */
}

#dataframe {
 color: black; background-color: white;
 width: 600px;
 height: 600px;
 /* resize doesn't work on Firefox. 
  On Chrome, the size may be increased, but not decreased*/
 resize: both;
 /*overflow: auto; */
}

#accentdiv,#outputdiv,#inputdiv,#dictionary input,label {display:block;}

#preferences {
 position:absolute;
 left:100px;
 top: 15px;
}
#preferences td {
 /*border:1px solid black;*/
 background-color:white;
 padding-left:5px;
 padding-right:5px;
 text-align:center;
}
#citationdiv{
 padding-bottom:5px;
}
#correction {

 padding-left: 130px;
}
/*
a.hwlinks:hover {
background-color:#A9C1CB;
cursor: pointer;
text-decoration: none
}
a.hwlinks:visited {
color:red;
}

#hwlinksmenu {
 height: 25px;line-height:25px;
 margin-top: 10px; margin-bottom:10px;
}
*/
</style>
<script> 
 // Jquery
$(document).ready(function() {
/* Deactivate previous keypress simple
 $('#key').keypress(function (e) {
  if(e.which == 13)  // the enter key code
   {e.preventDefault();
    listDisplay();
   }
 }); // end keypress
*/
$("#key").keypress(function (e) {
 var key = e.which;
 if(key == 13) {  // the enter key code
   var inputval = $('#input').val();
   console.log('inputval=',inputval);
    if(inputval != 'simple') {
     console.log(' keypress running listDisplay');
     listDisplay();
    } else {
     //otherwise, simple
     console.log(' keypress running simpleFunction');
     simpleFunction();
    }
    return false; // deactivate 'normal' return key functionality in JS.
  }
});   

 $('#input,#output,#dict,#accent').change(function(event) {
  console.log('change event #1',$('#dict').val());
  cookieUpdate(true);   
  $('#simpleinfo').html("");
 });
 $('#dict').change(function(event) {
  console.log('change event #2',$('#dict').val());
  changeCorrectionHref();
 });
 changeCorrectionHref = function () {
  var dict = $('#dict').val();
  var url = "/php/correction_form.php?dict=" + dict;
  $('#correction').attr('href',url);
 };
 listDisplay = function (keyin) {
  var key;
  if (keyin == undefined) {
   key = $('#key').val();  
  } else {
   key = keyin;
  }
  var dict = $('#dict').val();
  var input = $('#input').val();
  if (input == 'simple') {
   input = 'slp1';  // used when keyin is present.
  }
  console.log('listDisplay: keyin=',keyin,'input=',input);
  var output = $('#output').val();
  var accent = $('#accent').val();
  // TODO: check for valid inputs before ajax call
  var urlbase="//www.sanskrit-lexicon.uni-koeln.de/scans/awork/apidev/listview.php";
  var url =  urlbase +  
   "?key=" +escape(key) + 
   "&output=" +escape(output) +
   "&dict=" + escape(dict) +
   "&accent=" + escape(accent) +
   "&input=" + escape(input);
    //jQuery("#disp").html(""); // clear output
  console.log('listDisplay: url=',url);
  jQuery("#dataframe").attr("src",url);
    
 }; // listDisplay
 
cookieUpdate = CologneDisplays.dictionaries.cookieUpdate;
cookieUpdate(false);  // for initializing cookie
changeCorrectionHref();  // initialize now that #dict is set.
$("#dict").autocomplete( { 
  source : CologneDisplays.dictionaries.dictshow,
  autoFocus: true,
  minLength: 0,
 }); // end autocomplete dictionary

// ref: https://stackoverflow.com/questions/18160342/jquery-how-to-trigger-click-event-on-pressing-enter-key
simpleFunction = function(){
 // $('#simpleinfo').html("<p>This not yet functional</p>");
  var find_word = $('#key').val();
  find_word = find_word.trim();
  var test ={}; // Javascript object to pass as parameters
  //console.log('test: find_word=',find_word);
  test.key = find_word;
  test.url = "//www.sanskrit-lexicon.uni-koeln.de/scans/awork/apidev/simple-search/v1.0/getword_list_1.0.php";
  test.input = 'hk';
  test.output = $('#output').val(); //'deva';
  test.dict = $('#dict').val();; 
  //$('#outputdiv').html("<p>Accessing server for alternates of " + test.key + "  ...</p>");
  $.ajax({
   url: test.url,
   cache: false,
   method: "POST",
   data: {
    input:test.input, // not currently used
    output:test.output, // not currently used
    dict:test.dict, // not currently used
    key:test.key
   }
  }) // end of $.ajax
  .done(displayOption3)
  .fail(function( jqXHR, textStatus, errorThrown){
    $('#simpleinfo').html(
     textStatus.toString()+" "+errorThrown.toString()+"<br>");
 }); // end of $.ajax 

};

var displayOption3 = function(json) {
// Using select
   //console.log('json = ',json);
 var results = json['result'];
 var dict = json['dict'];
 var nresults = results.length;
 var nfound = nresults;
 var htmlarr = [];
 var dicthwfirst = null;
 //console.log('nfound=',nfound);
 if (nfound == 0) {
  htmlarr.push("WORD NOT FOUND in "+dict+ " dictionary");
/*
 }else if (nfound == 1) {
  dicthwfirst = results[0].dicthw;
*/
 }else {
  dicthwfirst = results[0].dicthw;
  htmlarr.push("<span style='margin-left:50px;'></span>");
  htmlarr.push('<select id="hwlinksmenu">')
  results.forEach(function(result,index) {
   var dicthw,dicthwoutput;
   dicthw = result['dicthw'];
   dicthwoutput = result['dicthwoutput'];
   
   var y =  "<option class='hwlinksitem' value='" + dicthw + "'";
   if (index == 0) {
    y = y + " selected='selected'";
   }
   var x = "<span>" + dicthwoutput + "</span>";
   y = y + ">" + x + "</option>";
   htmlarr.push(y);
   //htmlarr.push('<li >' +x + '</li>');
  });
  htmlarr.push('</select>')
  htmlarr.push("<span style='margin-left:10px'>" + nresults + "</span>");
 }

 var html = htmlarr.join("\n");
 $('#simpleinfo').html(html);
 
 $('#hwlinksmenu').css('margin','10px').css('height','35px').css('line-height','35px');
 //$('.hwlinksitem').css('margin','20px').css('height','35px').css('line-height','35px');
 //$('.hwlinksitem').css('padding-top','20px');
 
 $('#hwlinksmenu').change(function(event) {
  var key = $('#hwlinksmenu').val();
  //console.log('change event hwlinksmenu: key=',key);
  listDisplay(key);
 });
 // $('#hwlinksmenu').menu();
 //$('a.hwlinks:hover').css('cursor','pointer');
 if (dicthwfirst != null) {
  listDisplay(dicthwfirst);
 }
} // displayOption3

var displayOption2 = function(json) {
   //console.log('json = ',json);
 var results = json['result'];
 var dict = json['dict'];
 var nresults = results.length;
 var nfound = nresults;
 var htmlarr = [];
 var dicthwfirst = null;
 //console.log('nfound=',nfound);
 if (nfound == 0) {
  htmlarr.push("WORD NOT FOUND in "+dict+ " dictionary");
 }else if (nfound == 1) {
  dicthwfirst = results[0].dicthw;
 }else {
  dicthwfirst = results[0].dicthw;
  htmlarr.push('<ol>')
  results.forEach(function(result,index) {
   var dicthw,dicthwoutput;
   dicthw = result['dicthw'];
   dicthwoutput = result['dicthwoutput'];
   // <a  onclick='getWordAlt_keyboard("X");'><span style='color:black'> dicthwoutput</span></a>
   var x = "<a class='hwlinks' onclick='listDisplay(\"" + dicthw + "\");'>" +
    "<span>" + dicthwoutput + "</span></a>";
    //"<span style='color:black'>" + dicthwoutput + "</span></a>";
   htmlarr.push('<li >' +x + '</li>');
  });
  htmlarr.push('</ol>')
 }

 var html = htmlarr.join("\n");
 $('#simpleinfo').html(html);
 if (dicthwfirst != null) {
  listDisplay(dicthwfirst);
 }
} // displayOption2

displayOption1 = function(json) {
   //console.log('json = ',json);
   var results = json['result'];
   var dict = json['dict'];
   var htmlarr = [];
   htmlarr.push("<p>");
   htmlarr.push("Server returns " + results.length + " alternates. <br/> ");
   htmlarr.push("200 code means found in " + dict +". <br/> ");
   htmlarr.push("3rd field is word frequency score (or -1 or -9)<br/> ");
   htmlarr.push("last field is hwnorm1c data");
   htmlarr.push("</p>");
   var iresult = 0;
   var nfound = 0; 

   var dicthwfirst = null;
   results.forEach(function(result) {
    iresult = iresult + 1;
    var keyin = result.keyin;
    var keyslp = result.key;
    var status = result.status;
    var wf = result.wf;
    var data = result.xml;
    var dicthw = result.dicthw;
    console.log('dicthw=',dicthw);
    if (status == 200) {
     nfound = nfound + 1;
     if (dicthwfirst == null) {
        dicthwfirst = dicthw;
     }
     htmlarr.push(iresult + ':* ' + dicthw + '* ' + keyin + ' (' + keyslp + ') '+ status  
               + ' ' +  wf + '<br/>');
     /* data  is like  1: kavi (kavi) 200 44 
       kavi:ACC,AP,AP90,BEN,BOP,BUR,CAE,CCS,GRA,INM,MD,MW,MW72,PE,PUI,PW,PWG,SCH,SHS,STC,VCP,WIL,YAT;kaviH:SKD
       two levels: split at semicolon result is KEY:D1,D2,...
     */
     //var thetype = typeof data;
     var datastr = data;
     //console.log('type of data = ',typeof data);
     var parts = datastr.split(';');
     parts.forEach(function(item,index) {
      htmlarr.push("&nbsp;&nbsp;&nbsp;&nbsp;" + item + "<br/>");
     });
    }
   }); // results.foreach
   if (nfound == 0) {
    htmlarr.push("WORD NOT FOUND");
   }
   var html = htmlarr.join("\n");
   $('#simpleinfo').html(html);
   if (dicthwfirst != null) {
    listDisplay(dicthwfirst);
   }
  }

/* //citation AUTOCOMPLETE doesn't work with 'simple'. 
   //Deactivate it completely
// This is based on the example at
// https://jqueryui.com/autocomplete/#remote-jsonp
// and is required to avoid cross-domain problems.  The server program also
// requires some code for this purpose.

$("#key").autocomplete({
  source: function(request,response) {
   $.ajax({
   url:"//www.sanskrit-lexicon.uni-koeln.de/scans/awork/apidev/getsuggest.php",
   datatype:"jsonp",
   data: {
    //q: request.term
    term: request.term,
    dict: $('#dict').val(),
    input: $('#input').val()
   },
   success: function(data) {
    response(data);  // 'response' is passed in as source argument
   }
   }); // ajax
  },
  delay : 500, // 500 ms delay
  minLength : 2, // user must type at least 2 characters
  select: function(event,ui) {
   if (ui.item) {
   $("#key").val(ui.item.value);
    listDisplay();
   }
  },
  autoFocus: true,
}); //key-autocomplete
*/  // deactivation of autocomplete
}); // end ready
 </script>
<script> // see MWScan/2014/web/webtcdev/main_webtc.js
</script>
</head>
<body>
 <div id="logo">
     <a href="//www.sanskrit-lexicon.uni-koeln.de/">
      <img id="unilogo" src="//www.sanskrit-lexicon.uni-koeln.de/images/cologne_univ_seal.gif"
           alt="University of Cologne" width="60" height="60" 
           title="Cologne Sanskrit Lexicon"/>
      </a>
 </div>

<table id="preferences">
<tr><td>
 <div id="dictionary">
 <label for="dictcode">dictionary</label>
 <input type="text" name="dictcode" size="4" id="dict" value="" />
 </div>

</td><td>
 <div id="inputdiv">
  <label for="input">input</label>
  <select name="input" id="input">
   <option value='hk' selected='selected'>HK <!--Kyoto-Harvard--></option>
   <option value='slp1'>SLP1</option>
   <option value='itrans'>ITRANS</option>
   <option value='deva'>Devanagari</option>
   <option value='roman'>IAST</option>
   <option value='simple'>simpleHK</option>
  </select>
 </div>
</td><td>
 <div id="outputdiv">
  <label for="output">output</label>
  <select name="output" id="output">
   <option value='deva'>Devanagari</option>
   <option value='hk'>KH <!--Kyoto-Harvard--></option>
   <option value='slp1'>SLP1</option>
   <option value='itrans'>ITRANS</option>
   <option value='roman' selected='selected'>IAST</option>
  </select>
 </div>
</td><td>
 <div id="accentdiv">  <!-- possibly should be per dictionary -->
  <label for="accent">accent?</label>
 <select name="accent" id="accent">
  <option value="yes">Show</option>
  <option value="no" selected="selected">Hide</option>
 </select>
 </div>
</td></tr>
</table> <!-- preferences -->
 <div id="citationdiv">
  citation:&nbsp;
  <input type="text" name="key" size="20" id="key" value="" style="height:1.4em;"/>
  <!--<input type="button" id="correction" value="Corrections" /> -->
  <!-- href is set in change function on #dict -->
  <a id="correction" href="#" target="Corrections">Corrections</a>
 </div>
  
 <div id="simpleinfo"></div>
 <div id="disp">
  <!-- Requesting data will change the src attribute of this iframe -->
  <iframe id="dataframe">  
   <p>Your browser does not support iframes.</p>
  </iframe>
 </div>
</body>
</html>
